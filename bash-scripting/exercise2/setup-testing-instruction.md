# System Monitor Setup and Testing Guide

## Quick Start Setup

### 1. Create the Script
```bash
# Create the script directory
sudo mkdir -p /usr/local/bin

# Create the system monitor script
sudo nano /usr/local/bin/system_monitor.sh

# Copy the complete script content into the file
# Make it executable
sudo chmod +x /usr/local/bin/system_monitor.sh

# Create the reports directory
sudo mkdir -p /usr/local/system-reports

# Create log directory
sudo mkdir -p /var/log
```

### 2. Initial Testing
```bash
# Test the script manually
sudo /usr/local/bin/system_monitor.sh

# Test with help option
sudo /usr/local/bin/system_monitor.sh --help

# Test in test mode (display only, no file creation)
sudo /usr/local/bin/system_monitor.sh --test

# Test with custom parameters
sudo /usr/local/bin/system_monitor.sh -c 3 -d /tmp/test-reports
```

## Crontab Configuration

### 1. Set up Crontab
```bash
# Edit root crontab
sudo crontab -e

# Add this line to run every 2 hours
0 */2 * * * /usr/local/bin/system_monitor.sh

# Alternative: Run every 2 hours starting at 6 AM
0 6-22/2 * * * /usr/local/bin/system_monitor.sh

# Verify crontab entry
sudo crontab -l
```

### 2. Test Crontab (Alternative Times for Testing)
```bash
# For testing - run every 5 minutes
*/5 * * * * /usr/local/bin/system_monitor.sh

# For testing - run every hour
0 * * * * /usr/local/bin/system_monitor.sh

# Remember to change back to every 2 hours after testing!
```

## Testing Scenarios

### 1. Basic Functionality Test
```bash
# Run the script multiple times
sudo /usr/local/bin/system_monitor.sh
sudo /usr/local/bin/system_monitor.sh
sudo /usr/local/bin/system_monitor.sh

# Check generated reports
ls -la /usr/local/system-reports/

# View latest report
cat /usr/local/system-reports/system_report_*.txt | head -50
```

### 2. Report Rotation Test
```bash
# Generate more than 5 reports to test cleanup
for i in {1..8}; do
    sudo /usr/local/bin/system_monitor.sh
    sleep 2
done

# Check that only 5 reports remain
ls -la /usr/local/system-reports/ | wc -l
```

### 3. Error Handling Test
```bash
# Test with invalid directory
sudo /usr/local/bin/system_monitor.sh -d /invalid/directory

# Test with invalid report count
sudo /usr/local/bin/system_monitor.sh -c 0

# Test with insufficient permissions
chmod 000 /usr/local/system-reports/
/usr/local/bin/system_monitor.sh
sudo chmod 755 /usr/local/system-reports/
```

### 4. Custom Configuration Test
```bash
# Test with custom settings
sudo /usr/local/bin/system_monitor.sh -d /tmp/custom-reports -c 3

# Verify custom directory
ls -la /tmp/custom-reports/
```

## Verification Steps

### 1. Check Script Output
```bash
# View a complete report
cat /usr/local/system-reports/system_report_*.txt

# Check for all required sections
grep -E "DISK|IP|UPTIME|MEMORY" /usr/local/system-reports/system_report_*.txt
```

### 2. Monitor Logs
```bash
# Check script logs
sudo tail -f /var/log/system_monitor.log

# Check cron logs
sudo tail -f /var/log/cron.log
# or
sudo journalctl -u cron -f
```

### 3. Validate Crontab Execution
```bash
# Check cron service status
sudo systemctl status cron

# Check recent cron jobs
sudo grep "system_monitor" /var/log/cron.log | tail -10
```

## Sample Report Structure

A successful report should look like this:
```
===============================================
        SYSTEM MONITORING REPORT
===============================================
Generated: Fri Jul 11 14:30:01 UTC 2025
Hostname: server01
===============================================

=== DISK SPACE UTILIZATION ===
Timestamp: Fri Jul 11 14:30:01 UTC 2025

Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        20G  8.5G   11G  44% /
/dev/sda2       100G   45G   50G  47% /home

Critical Disk Usage (>80%):

=== IP CONFIGURATION ===
Timestamp: Fri Jul 11 14:30:01 UTC 2025

Network Interfaces:
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN
    inet 127.0.0.1/8 scope host lo
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP
    inet 192.168.1.100/24 brd 192.168.1.255 scope global eth0

Routing Table:
default via 192.168.1.1 dev eth0

=== SYSTEM UPTIME ===
Timestamp: Fri Jul 11 14:30:01 UTC 2025

 14:30:01 up 15 days,  3:45,  2 users,  load average: 0.25, 0.30, 0.28

Boot Time: Thu Jun 26 10:45:01 UTC 2025

=== MEMORY INFORMATION ===
Timestamp: Fri Jul 11 14:30:01 UTC 2025

              total        used        free      shared  buff/cache   available
Mem:           8.0G        4.2G        1.8G        256M        2.0G        3.8G
Swap:          2.0G        512M        1.5G

Memory Usage: 52%

===============================================
           END OF REPORT
===============================================
Report generated by: /usr/local/bin/system_monitor.sh
Report location: /usr/local/system-reports/system_report_2025-07-11_14-30-01.txt
===============================================
```

## Troubleshooting

### Common Issues:
1. **Permission Denied**: Run with sudo or adjust permissions
2. **Directory Not Found**: Check if directories exist and are writable
3. **Command Not Found**: Verify required utilities are installed
4. **Crontab Not Running**: Check if cron service is running
5. **No Reports Generated**: Check script logs and cron logs

### Debug Commands:
```bash
# Check script permissions
ls -la /usr/local/bin/system_monitor.sh

# Check directory permissions
ls -la /usr/local/system-reports/

# Test individual components
df -h
ip addr show
uptime
free -h

# Check cron service
sudo systemctl status cron
```

## Success Criteria Checklist

- [ ] Script executes without errors
- [ ] All four metrics are collected (disk, IP, uptime, memory)
- [ ] Reports are saved with timestamps
- [ ] Only 5 most recent reports are kept
- [ ] Crontab is configured for every 2 hours
- [ ] Script runs automatically via cron
- [ ] Proper error handling and logging
- [ ] Reports are human-readable and formatted properly
